<html>
  <head></head>
  <body>
    <h1>Fruple Lite v.0.0.420</h1>
    <table>
      <tr>
        <td></td>
        <td><button onclick="move('ArrowUp')" value="">N</button></td>
        <td></td>
      </tr>
      <tr>
        <td><button onclick="move('ArrowLeft')">W</button></td>
        <td></td>
        <!-- <td><input type="text" oninput="move(event.key)"></td> -->
        <td><button onclick="move('ArrowRight')">E</button></td>
      </tr>
      <tr>
        <td></td>
        <td><button onclick="move('ArrowDown')">S</button></td>
        <td></td>
      </tr>
    </table>

    <p>X      <input type="number" id="x"      onchange="set(this)"></p>
    <p>Y      <input type="number" id="y"      onchange="set(this)"></p>
    <p>Energy <input type="number" id="energy" onchange="set(this)"></p>
    <p>Money  <input type="number" id="money"  onchange="set(this)"></p>

    <textarea id="message" style="width: 100%; height: 500px" disabled></textArea>
  </body>

<script>
//create map
var tileMessage = 
["Your mind goes blank, uninspired by the boring landscape around.",
 "YUCK! You've stepped into a bog and used up an extra energy point."];
class tile{
  constructor(){
    this.messageIndex = 0;
    this.energyLoss = 1;
  }

  get message(){
    return tileMessage[this.messageIndex];
  }
  get energy(){
    return this.energyLoss;
  }

  set message(newValue){
    if(typeof newValue === "number" && newValue < tileMessage.length)
      this.messageIndex = newValue;
    else{
      message = newValue + " is not a valid message index.";
      updateUI();
    }
  }
  set energy(newValue){
    if(typeof newValue === "number")
      this.energyLoss = newValue;
    else{
      message = newValue + " is not a valid energy loss number.";
      updateUI();
    }
  }
}

var bog = new tile();
bog.message = 1;
bog.energy = 2;

//var map = [new tile()[25]][new tile()[25]];
var map = new Array(25);
for(var i = 0; i < map.length; ++i)
  map[i] = new Array(25);
for(var x = 0; x < map.length; ++x)
  for(var y = 0; y < map[x].length; ++y)
    map[x][y] = new tile();

map[0][4] = map[1][3] = map[4][0] = map[3][3] = bog;

//create stats
var x       = 11,
    y       = 11, 
    energy  = 100,
    money   = 25,
    message = "";

//other varaibles
var xDisplay = document.getElementById("x");
var yDisplay = document.getElementById("y");
var energyDisplay = document.getElementById("energy");
var moneyDisplay = document.getElementById("money");
var messageDisplay = document.getElementById("message");

//get started
updateUI();

//function definitions
function move(direction){
  switch(direction){
    case "ArrowUp":    ++y; message = "MOVING north.";    break;
    case "ArrowLeft":  --x; message = "MOVING west.";  break;
    case "ArrowRight": ++x; message = "MOVING east."; break;
    case "ArrowDown":  --y; message = "MOVING south.";  break;
    default:                return;                    break;
  }
  handleMapBounds();

  message += "\n" + map[x][y].message;
  energy -= map[x][y].energy;

  handleDeath();
  updateUI();
}

function handleDeath(){
  if(energy > 0) return;
  message = "You ran out of energy and died. However, you have been resurrected.";
  energy = 25;
  x = 11;
  y = 11;
}

function handleMapBounds(){
  if(x < 0 || y < 0 || x > map.length - 1 || y > map[0].length - 1){
    x = 11;
    y = 11;
    message += "\nYIKES! You've walked off the edge of the world - you've been relocated!";
  }
}

function updateUI(){
  xDisplay.value = x + 1;
  yDisplay.value = y + 1;
  //ui is 1 indexed, array 0 indexed
  energyDisplay.value = energy;
  moneyDisplay.value = money;
  //var now = new Date();
  messageDisplay.innerHTML = 
    //now.toTimeString() + "\n" +
    message + "\n\n" + 
    messageDisplay.innerHTML;
  message = "";
}

function set(caller){
  var newValue = eval(caller.value);
  if(typeof newValue != "number"){
    message = newValue + " is not a number. Rejecting input.";
    updateUI();
    return;
  }

  message += "Updating ";
  switch(caller.id){
    case "x":      x      = newValue - 1; message += "x";      break;
    case "y":      y      = newValue - 1; message += "y";      break;
    //ui is 1 indexed, array 0 indexed
    case "energy": energy = newValue;     message += "energy"; break;
    case "money":  money  = newValue;     message += "money";  break;
    default:             message += "lel nice try";        break;
  }
  message += "... Condition checking will begin with your next move.";
  updateUI();
}
</script>
</html>
